#!/bin/bash

set -eu

cwd="$(realpath "$(dirname "${BASH_SOURCE[0]}")")"

cd "${cwd}/../home"

target="$HOME"

find . -type f -print0 | while IFS= read -rd $'\0' file; do
  path="$(echo "$file" | sed -e "s/^\.\/\{0,\}//g")" # Trim off the "." at the start of the string
  dir="$(dirname -- "$path")"

  if [[ "$dir" != "." ]]; then
    mkdir -p "${target}/.${dir}"
  fi

  ln -sfn "${PWD}/${path}" "${target}/.${path}"
done
